<!DOCTYPE html>
<html>
  <head>
    <title>Global Plastic Pollution</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>
    <link href="./css/style.css" rel="stylesheet" />
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
  </head>

  <body>
    <!-- "navigation bar" -->
    <header>
      <h1><a href="index.html" style="color: white; text-decoration: none;">Global Plastic Solution</a></h1>
    </style>
      <nav>
          <ul class="nav__links">

              <li><a href="datasources.html" style="color: white">Data Sources</a></li>
              <li><a href="about.html" style="color: white">About</a></li>
              <li><a href="authors.html" style="color: white">Authors</a></li>
          </ul>
      </nav>
  </header>  
  <!--  -->
    <script src="./assets/data_for_choropleth.js"></script>

    <div class="container">
      <div class="widgets">
        <div class="widget-background"></div>
        <div class="widget" style="height: 50%">
          <h2>Global Plastic Production & Recycling </h2>
          <div id="curve_chart"></div>
          <p>The following line graph uses data from: <a href="https://github.com/myho1998/The-world-s-plastic-polution/blob/main/assets/global-plastics-production.csv" target="_blank">Global Plastic Production Dataset.</a>. </p> 
          <p>The following line graph displays global plastic production vs global plastic recycled in 1950-2019 period. The gap between the production and recycled management are huge which are the discarded plastic goes into uncontrolled dumpsites, is burned in open pits or ends up in terrestrial or aquatic environments, especially in poorer countries.  </p>
        </div>
        <!--  -->

        <!-- PIE CHART SECTION -->
        <!-- "widget" div -->
        <div class="widget" style="height: 50%">
          <h2>Plastic Exports by</h2>

          <!-- Categories Dropdown menu area -->
          <div class="dropdown">
            <button id="pie_selector" class="dropbtn">Country</button>
            <div class="dropdown-content">
              <a href="#" onclick="selectView('Country')">Country</a>
              <a href="#" onclick="selectView('Continent')">Continent</a>
              <a href="#" onclick="selectView('Income Level')">Income Level</a>
            </div>
          </div>
          <!-- -->

          <link rel='css' href='css/style.css' />
          <link rel='css' href='css/bootstrap.min.css' />
          <link rel='css' href='css/font-awesome.min.css' />
          <!-- Load c3.css -->
          <link href="css/c3.css" rel="stylesheet" type="text/css">
          <!-- Load d3.js and c3.js -->
          <script src="js/d3.v3.min.js" charset="utf-8"></script>
          <script src="js/c3.min.js"></script>
          <!-- Load papaparse.js -->
          <script src="js/papaparse.min.js"></script>
          <div class="container">
            <div id="chart"></div>
          </div>

          <!-- Loads pie chart -->
          <script src="js/export_pie_chart.js"></script>
          <!-- Description of pie chart -->
          <p>The following pie chart displays global plastic exports between different countries, continents, and income level in 2010. The following chart shows each group's global share for exports relative to their counterparts, while also displaying the exact amount when hovered over. </p>
        </div> <!-- "widget" div -->

        <!-- Loads line graph chart -->
        <script src="js/linegraph.js"></script>
      </div> <!-- "widgets" div -->
      <div id="map" class="map"></div>
    </div> <!-- "container" div -->
  
    <!-- CHLOROPETH MAP SECTION -->
    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoibGlsbGx5MDIiLCJhIjoiY2xkZ2o4dTA1MHh1MTNxcjhjbmxucGZjZSJ9.ODEhxh5a5B_as4sMO9Z73w';
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v11',
        center: [12, 50],
        zoom: 2.2
      });
      map.on('load', () => {
        // Add source for country polygons using the Mapbox Countries tileset
        map.addSource('countries', {
          type: 'vector',
          url: 'mapbox://mapbox.country-boundaries-v1'
        });
        // Use the ISO 3166-1 alpha 3 code as the lookup key for the country shape
        const matchExpression = ['match', ['get', 'iso_3166_1_alpha_3']];
        //Calculate color values for each country based on 'pWaste2016' value
        for (const row of data) {
          // Convert the range of data values to a suitable color
          const blue = row['pWastePercap2016'] * 10;
          const color = `rgb(0, 0, ${blue})`;
          matchExpression.push(row['cca3'], color);
        }
      
        matchExpression.push('rgba(0, 0, 0, 0)');
        
        map.addLayer({
          'id': 'countries-join',
          'type': 'fill',
          'source': 'countries',
          'source-layer': 'country_boundaries',
          'paint': {
            'fill-color': matchExpression,
            'fill-opacity': 0.2
          }
        });
      });

      // adding popup
      const popup = new mapboxgl.Popup({
        closeButton: false,
        closeOnClick: false
      });

      map.on('mouseenter', 'countries-join', (e) => {
      // Change the cursor style as a UI indicator.
        map.getCanvas().style.cursor = 'pointer';

        const coordinates = row['longitude'] + "," + row['latitude'].slice();
        const description = row['pWastePercap2016']

      // Ensure that if the map is zoomed out such that multiple
      // copies of the feature are visible, the popup appears
      // over the copy being pointed to.
      while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
      coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
      }

      // Populate the popup and set its coordinates
      // based on the feature found.
      popup.setLngLat(coordinates).setHTML(description).addTo(map);
      });

      map.on('mouseleave', 'countries-join', () => {
          map.getCanvas().style.cursor = '';
          popup.remove();
      });

      map.addControl(new mapboxgl.NavigationControl());
    </script>
    <!--  -->
  </body>
</html>